# ===============================================
# Nginx 配置 - 前端 SPA 应用
# ===============================================
#
# 为什么需要特殊配置？
# React 是 SPA（单页应用），所有路由都由前端 JS 处理
# 当用户直接访问 /goals 时，Nginx 默认会找 /goals 文件
# 找不到就返回 404，所以需要配置：所有路径都返回 index.html
# ===============================================

server {
    listen 80;
    server_name localhost;
    
    # 静态文件根目录
    root /usr/share/nginx/html;
    index index.html;

    # Gzip 压缩，减少传输体积
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
    gzip_min_length 1000;

    # 静态资源缓存策略
    # 带 hash 的文件（如 main.abc123.js）可以长期缓存
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPA 路由处理
    # try_files: 按顺序尝试
    # 1. $uri - 精确匹配请求的文件
    # 2. $uri/ - 尝试作为目录
    # 3. /index.html - 都找不到就返回 index.html（交给前端路由）
    location / {
        try_files $uri $uri/ /index.html;
    }

    # API 代理（后续添加后端时使用）
    # location /api {
    #     proxy_pass http://server:8080;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    # }
}
