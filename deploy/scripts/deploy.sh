#!/bin/bash
# ===============================================
# éƒ¨ç½²è„šæœ¬
# ===============================================
#
# ç”¨é€”ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œæ‹‰å–æœ€æ–°ä»£ç å¹¶é‡æ–°éƒ¨ç½²
# æ‰§è¡Œæ–¹å¼ï¼š
#   chmod +x deploy.sh
#   ./deploy.sh
#
# ===============================================

set -e

APP_DIR="/opt/starthere"

echo "=========================================="
echo "ğŸš€ StartHere éƒ¨ç½²è„šæœ¬"
echo "=========================================="

cd $APP_DIR

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
echo "ğŸ³ é‡æ–°æ„å»ºå¹¶å¯åŠ¨å®¹å™¨..."
docker-compose down
docker-compose up -d --build

# æ¸…ç†æ—§é•œåƒ
echo "ğŸ§¹ æ¸…ç†æ—§é•œåƒ..."
docker image prune -f

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
docker-compose ps

echo "=========================================="
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "=========================================="
